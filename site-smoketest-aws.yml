- name: Smoketest for production environments
  hosts: frontends
  gather_facts: true
  tasks:

  - name: install boto3
    become: true
    yum:
      name: python2-boto3

  - ec2_instance_facts:
      region: us-east-1
      filters:
        "tag:instance_filter": three-tier-app-pawel.wlodarczyk*
    register: outoutout

  - debug: var=outoutout

  - name: Checking if website available localy
    uri:
      url: http://localhost
      method: GET
      return_content: true
    register: smokeaws
    tags:
      - aws.smoke

#  - debug: msg="{{ smokeaws }}"


  - name: Fail if 'Ansible has done its job' is not in the page content
    fail:
    when: "'Ansible has done its job' not in smokeaws.content"
    tags:
      - aws.smoke
